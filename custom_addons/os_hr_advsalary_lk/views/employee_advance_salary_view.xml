<?xml version="1.0" encoding="utf-8"?>
<odoo>

	<record id="act_employee_loan_6_hr_contract" model="ir.actions.act_window">
	    <field name="name">Contracts</field>
	    <field name="res_model">hr.contract</field>
	    <field name="view_type">form</field>
	    <field name="view_mode">kanban,tree,form</field>
	    <field name="context">{
	    	'search_default_employee_id': [employee_id],
            'default_employee_id': employee_id,
	        'search_default_group_by_state': 1
	    }</field>
    </record>
	
	<record id="advance_salary_view_form" model="ir.ui.view">
		<field name="name">advance.salary.form</field>
		<field name="model">advance.salary.request</field>
		<field name="arch" type="xml">
	   		<form string="Advance Salary Request">
       			<header>
       				<button name="confirm_salary_request" string="Confirm" states="draft" class="btn btn-primary" type='object'></button>
               		<button name="approve_salary_request" string="Approve" states="confirm" class="btn btn-primary" type='object' groups='hr.group_hr_manager'></button>
               		<button name="reset_salary_request" string="Reset to Draft" states="confirm" class="btn btn-primary" type='object'></button>
               		<button name="cancel_salary_request" states="confirm" string="Cancel" type='object'></button>
                 	<button name="reject_salary_request" string="Reject" states="confirm" type='object' groups='hr.group_hr_manager'></button>
                	<field name="state" widget="statusbar"/>
                </header>
                <sheet>
                	<div class="oe_button_box" name="button_box">
	                	<button name="%(act_employee_loan_6_hr_contract)d" class="oe_stat_button" icon="fa-book"
                           		type="action" groups="hr.group_hr_manager" context="{'employee_id': employee_id}">
                          		<field name="contracts_count" widget="statinfo"/>
                       	</button>
                    </div>
                	<div class="oe_title" name="title">
	                    <label for="reference_no" class="oe_edit_only"/>
	                    <h1>
	                        <field name="reference_no" placeholder="Reference No"/>
	                    </h1>
                	</div>
     				<group colspan="4" cols="4">
		       			<group>
			            	<field name="employee_id" attrs="{'readonly': [('state','in',['approve','cancel','reject'])]}"/>
			       			<field name="emp_code" editable="1" attrs="{'readonly': [('state','in',['approve','cancel','reject'])]}"/>
			       			<field name="created_date"/>
			       		</group>
			            <group>
			           		<field name="advance_amount" attrs="{'readonly': [('state','in',['approve','cancel','reject'])]}"/>
			       			<field name="deduct_from_salary" />
			       			<field name="repaid" groups='hr.group_hr_manager'/>
			       		</group>
			        </group>
		            <notebook>
			     		<page string="Previous Advances" groups='hr.group_hr_manager'>
			     			<field name="previous_advances_ids" nolabel="1" widget="one2many_list" attrs="{'readonly': [('state','in',['approve','cancel','reject'])]}">
			            		<tree editable="top" >
                                    <field name="ref_no" />
                                    <field name="create_date" />
                                    <field name="amount" />
                                    <field name="repaid"/>
	                            </tree>
		            		</field>
			     		</page>
			     		<page string="Comments" >
			     			<field name="comments" nolabel="1" attrs="{'readonly': [('state','in',['approve','cancel','reject'])]}"/>
			     		</page>
			     	</notebook>
        		</sheet>
	    	</form>
		</field>
	</record>
	
	<record id="advance_salary_view_tree" model="ir.ui.view">
		<field name="name">advance.salary.tree</field>
		<field name="model">advance.salary.request</field>
		<field name="arch" type="xml">
	   		<tree string="Advance Salary Request">
            	<field name="reference_no"/>
            	<field name="employee_id"/>
            	<field name="created_date"/>
       			<field name="advance_amount"/>
       			<field name="repaid"/>
       			<field name="state"/>
	    	</tree>
		</field>
	</record>
	
	<record id="advance_salary_search_view" model="ir.ui.view">
		<field name="name">advance.salary.search</field>
		<field name="model">advance.salary.request</field>
		<field name="arch" type="xml">
	   		<search string="Search Salary Request">
                   <filter string="Pending" name="repaid_filter" domain="[('repaid','=',False)]"/>
                   <filter string="Approved" name="approve" domain="[('state','=','approve')]"/>
                   <filter string="Confirmed" name="confirm" domain="[('state','=','confirm')]"/>
                   <separator/>
                   <field name="reference_no" string="Reference"/>
                   <field name="employee_id" string="Employee"/>
                   <group expand="0" name="group_by" string="Group By">
                       <filter name="state" string="State" domain="[]" context="{'group_by' : 'state'}"/>
                   </group>
               </search>
		</field>
	</record>
	
	<!-- Salary Rule Inherit -->
    <record id="hr_salary_rule_form_inherit_salary" model="ir.ui.view">
    	<field name="name">hr.salary.rule.form.inherit.salary</field>
    	<field name="model">hr.salary.rule</field>
    	<field name="inherit_id" ref="hr_payroll.hr_salary_rule_form"/>
    	<field name="arch" type="xml">
    		<data>
	    		<xpath expr="//field[@name='appears_on_payslip']" position="after">
					<field name ="advance_salary" />
				</xpath>
    		</data>
    	</field>
    </record>
	
	<record id="action_advance_salary_view" model="ir.actions.act_window">
        <field name="name">Advance Salary</field>
        <field name="res_model">advance.salary.request</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{"search_default_repaid_filter":True}</field>
        <field name="help" type="html">
   	 		<p class="oe_view_nocontent_create">
      				Click to create a Advance Salary Request.
    			</p>
   	 	</field>
        
    </record>
	
	<menuitem action="action_advance_salary_view" id="menu_advance_salary" parent="hr.menu_hr_root"
			  groups="base.group_user" sequence="3"/>
</odoo>
